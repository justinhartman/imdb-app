<%
const seasonNum = Number(season);
const episodeNum = Number(episode);
const autoplayVal = Number(autoplay) || 0;
const totalSeasons = seriesDetail?.totalSeasons || 0;
const currentSeason = seriesDetail?.seasons?.find(s => s.season === seasonNum) || { episodes: [] };
const maxEpisodes = currentSeason.episodes.length;
let prevDisabled = false;
let nextDisabled = false;
let prevLink = `${APP_URL}/view/${id}/${type}/${seasonNum}/${episodeNum - 1}/${autoplayVal}`;
let nextLink = `${APP_URL}/view/${id}/${type}/${seasonNum}/${episodeNum + 1}/${autoplayVal}`;
if (episodeNum <= 1) {
  if (seasonNum > 1) {
    const prevSeason = seasonNum - 1;
    const prevSeasonEpisodes = seriesDetail.seasons.find(s => s.season === prevSeason)?.episodes.length || 0;
    prevLink = `${APP_URL}/view/${id}/${type}/${prevSeason}/${prevSeasonEpisodes}/${autoplayVal}`;
  } else {
    prevDisabled = true;
    prevLink = '#';
  }
}
if (episodeNum >= maxEpisodes) {
  if (seasonNum < totalSeasons) {
    const nextSeason = seasonNum + 1;
    nextLink = `${APP_URL}/view/${id}/${type}/${nextSeason}/1/${autoplayVal}`;
  } else {
    nextDisabled = true;
    nextLink = '#';
  }
}
const autoplayEnabled = autoplayVal === 1;
const toggleAutoplay = autoplayEnabled ? 0 : 1;
const toggleLink = `${APP_URL}/view/${id}/${type}/${seasonNum}/${episodeNum}/${toggleAutoplay}`;
const autoplayText = autoplayEnabled ? 'Autoplay On' : 'Autoplay Off';
%>
<div id="series-buttons" class="px-1 w-100">
    <div class="btn-group mb-2 w-100">
        <a href="<%= prevLink %>" class="btn bg-primary border border-primary-subtle btn-sm p-2 <%= prevDisabled ? 'disabled' : '' %>"><i class="bi bi-caret-left-square"></i> Previous</a>
        <a href="<%= toggleLink %>" class="btn text-secondary bg-secondary-subtle border border-secondary-subtle btn-sm p-2"><i class="bi bi-lightning-fill"></i> <%= autoplayText %></a>
        <a href="<%= nextLink %>" class="btn bg-success border border-success-subtle btn-sm p-2 <%= nextDisabled ? 'disabled' : '' %>">Next <i class="bi bi-caret-right-square"></i></a>
    </div>
</div>
